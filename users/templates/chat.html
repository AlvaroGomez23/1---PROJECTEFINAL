<!DOCTYPE html>
<html>
<head>
    <title>Chat</title>
    <script>
        const roomName = "{{ room_name }}";
        const currentUser = "{{ request.user.username }}";
        const otherUser = roomName;
    
        // Verifica si la conexi√≥n es correcta (ws:// o wss:// seg√∫n el protocolo)
        const wsProtocol = window.location.protocol === "https:" ? "wss" : "ws";
        const ws = new WebSocket(`${wsProtocol}://${window.location.host}/ws/chat/${roomName}/`);
    
        ws.onopen = function() {
            console.log("‚úÖ WebSocket conectado con √©xito!");
        };
    
        ws.onerror = function(error) {
            console.error("‚ùå Error en WebSocket:", error);
        };
    
        ws.onmessage = function(event) {
            const data = JSON.parse(event.data);
            console.log("üì© Mensaje recibido:", data);
            const chatLog = document.getElementById('chat-log');
            chatLog.value += `${data.sender}: ${data.message}\n`;
        };
    
        ws.onclose = function() {
            console.warn("‚ö†Ô∏è WebSocket cerrado.");
        };
    
        function sendMessage() {
            const messageInput = document.getElementById('message-input');
            const message = messageInput.value;
    
            if (message.trim() === "") return;
    
            console.log("üì§ Enviando mensaje:", message);
    
            ws.send(JSON.stringify({
                'message': message,
                'sender': currentUser,
                'receiver': otherUser
            }));
    
            messageInput.value = '';
        }
    </script>
</head>
<body>
    <h1>Chat</h1>
    <textarea id="chat-log" cols="100" rows="20" readonly></textarea><br>
    <input id="message-input" type="text" size="100">
    <button onclick="sendMessage()">Enviar</button>
</body>
</html>